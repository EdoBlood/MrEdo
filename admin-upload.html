<!DOCTYPE html>
<html>
<head>
  <title>Admin Upload</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
</head>
<body class="p-4">
  <h2>Upload New Quiz</h2>
  <form id="uploadForm">
    <input type="text" class="form-control mb-2" placeholder="Course Code (e.g. CPT122)" id="name" required />
    <select class="form-select mb-2" id="level">
      <option value="100">100 Level</option>
      <option value="200">200 Level</option>
      <option value="300">300 Level</option>
      <option value="400">400 Level</option>
    </select>
    <select class="form-select mb-2" id="status">
      <option value="Free">Free</option>
      <option value="Paid">Paid</option>
    </select>
    <input type="number" class="form-control mb-2" placeholder="Price (â‚¦)" id="price" />
    <input type="file" class="form-control mb-2" id="file" required />
    <button type="submit" class="btn btn-success">Upload</button>
  </form>

  <script>
    const supabase = supabase.createClient(
      'https://exebxtduexxgckezhdky.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4ZWJ4dGR1ZXh4Z2NrZXpoZGt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NDQ4MTYsImV4cCI6MjA3NDAyMDgxNn0.Jq6TWKe53uuBFd0ECuefyluZxRCrqaAKrp6ZJu8DSbA'
    );

    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const level = document.getElementById('level').value;
      const status = document.getElementById('status').value;
      const price = parseInt(document.getElementById('price').value || 0);
      const fileInput = document.getElementById('file');
      const file = fileInput.files[0];
      const filename = file.name;

      const { error: uploadError } = await supabase.storage
        .from('quizzes')
        .upload(filename, file);

      if (uploadError) return alert('Upload failed');

      await supabase.from('quizzes').insert({
        name,
        level,
        status,
        price,
        filename
      });

      alert('Quiz uploaded successfully!');
      document.getElementById('uploadForm').reset();
    });
  </script>
</body>
</html>
